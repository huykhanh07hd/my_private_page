<html>
    <head>
        <title> My caculator </title>
        <p style="text-align: center"> Let's calculating </p>
    </head>
    <body>
        <table border="1" style="width: 500px; height: 500px; margin: 0 auto">
            <tr style="text-align: center">
                <!-- Đây là dòng mà máy tính sẽ hiện ra các con số-->
                <td colspan="4">
                    <div id = "screen"> Get's started </div>
                </td>
            </tr>
            <tr style="text-align: center">
                <td>
                    <button onclick="addition()" style="width: 100%; height: 100%"> + </button>
                </td>
                <td>
                    <button onclick="substraction()" style="width: 100%; height: 100%"> - </button>
                </td>
                <td>
                    <button onclick="mutiplication()" style="width: 100%; height: 100%"> * </button>
                </td>
                <td>
                    <button onclick="division()" style="width: 100%; height: 100%"> / </button>
                </td>
            </tr> 
            <tr style="text-align: center">
                <td>
                    <button onclick="append(0)" style="width: 100%; height: 100%"> 0 </button>
                </td>
                <td>
                    <button onclick="append(1)" style="width: 100%; height: 100%"> 1 </button>
                </td>
                <td>
                    <button onclick="append(2)" style="width: 100%; height: 100%"> 2 </button>
                </td>
                <td>
                    <button onclick="append(3)" style="width: 100%; height: 100%"> 3 </button>
                </td>
            </tr>
            <tr style="text-align: center">
                <td>
                    <button onclick="append(4)" style="width: 100%; height: 100%"> 4 </button>
                </td>
                <td>
                    <button onclick="append(5)" style="width: 100%; height: 100%"> 5 </button>
                </td>
                <td>
                    <button onclick="append(6)" style="width: 100%; height: 100%"> 6 </button>
                </td>
                <td>
                    <button onclick="append(7)" style="width: 100%; height: 100%"> 7 </button>
                </td>
            </tr>
            <tr style="text-align: center">
                <td>
                    <button onclick="append(8)" style="width: 100%; height: 100%"> 8 </button>
                </td>
                <td>
                    <button onclick="append(9)" style="width: 100%; height: 100%"> 9 </button>
                </td>
                <td>
                    <button onclick="comma()" style="width: 100%; height: 100%"> . </button>
                </td>
                <td>
                    <!-- Nút này để hiện lên kết quả ở dòng trên cùng-->
                    <button onclick="equal()" style="width: 100%; height: 100%"> = </button>
                </td>
            </tr>
            <tr style="text-align: center">
                <!-- Đây là dòng để clear tính lại từ đầu-->
                <td colspan="4">
                    <button onclick="restart()" style="width: 100%; height: 100%"> clear </button>
                </td>
            </tr>
        </table>
        <script>
            var operator = ""
            var cnt = 0 
            var init = -1000000000000000000
            var isInitialState = true 
            var current_display = init
            var current_number = 0
            var arr = []
            var cl = []
            var val = []
            function clearInitialScreen() {
                if (isInitialState) {
                    document.getElementById("screen").innerHTML = ""
                    isInitialState = false
                }
            }
            function addition() {
                if ((current_display == init) || (operator == ",") 
                || (ok_add == 1) || (ok_sub == 1) || (ok_mul == 1) || (ok_div == 1)) {
                    alert("The format you use is invalid")
                } 
                else {
                    clearInitialScreen()
                    document.getElementById("screen").innerHTML += "+"
                    arr.push(current_number)
                    arr.push("+")
                    current_number = 0
                    ok_add = 1
                    ok_sub = 0
                    ok_mul = 0
                    ok_div = 0
                    operator = ""
                    cnt = 0
                }
            }
            function substraction() {
                if ((current_display == init) || (operator == ",") 
                || (ok_add == 1) || (ok_sub == 1) || (ok_mul == 1) || (ok_div == 1)) {
                    alert("The format you use is invalid")
                } 
                else {
                    clearInitialScreen()
                    document.getElementById("screen").innerHTML += "-"
                    arr.push(current_number)
                    arr.push("-")
                    current_number = 0
                    ok_add = 0
                    ok_sub = 1
                    ok_mul = 0
                    ok_div = 0
                    operator = ""
                    cnt = 0
                }
            }
            function mutiplication() {
                if ((current_display == init) || (operator == ",") 
                || (ok_add == 1) || (ok_sub == 1) || (ok_mul == 1) || (ok_div == 1)) {
                    alert("The format you use is invalid")
                } 
                else {
                    clearInitialScreen()
                    document.getElementById("screen").innerHTML += "*"
                    arr.push(current_number)
                    arr.push("*")
                    current_number = 0
                    ok_add = 0
                    ok_sub = 0
                    ok_mul = 1
                    ok_div = 0
                    operator = ""
                    cnt = 0
                }
            }
            function division() {
                if ((current_display == init) || (operator == ",") 
                || (ok_add == 1) || (ok_sub == 1) || (ok_mul == 1) || (ok_div == 1)) {
                    alert("The format you use is invalid")
                } 
                else {
                    clearInitialScreen()
                    document.getElementById("screen").innerHTML += "/"
                    arr.push(current_number)
                    arr.push("/")
                    current_number = 0
                    ok_add = 0
                    ok_sub = 0
                    ok_mul = 0
                    ok_div = 1
                    operator = ""
                    cnt = 0
                }
            }
            function append(number) {
                clearInitialScreen()
                if (operator == "") {
                    document.getElementById("screen").innerHTML += number
                    current_number = current_number * 10 + number
                    current_display = current_number
                    ok_add = 0
                    ok_sub = 0
                    ok_mul = 0
                    ok_div = 0
                    operator = ""
                }
                else if (operator == "," || operator == "ok_,") {
                    document.getElementById("screen").innerHTML += number
                    ok_add = 0
                    ok_sub = 0
                    ok_mul = 0
                    ok_div = 0
                    cnt += 1
                    current_number = current_number + number/(10**cnt)
                    current_display = current_number
                    operator = "ok_,"
                }
            }
            function comma() {
                clearInitialScreen()
                if ((current_display == init) || (cnt != 0) || (operator == ",") || (operator == "ok_,")
                || (ok_add == 1) || (ok_sub == 1) || (ok_mul == 1) || (ok_div == 1)) {
                    alert("The format you use is invalid")
                }
                else {
                    document.getElementById("screen").innerHTML += "."
                    operator = ","
                }
            }
            function solve() {
                arr.push(current_number)
                for (var i = 0; i < arr.length; i += 1) {
                    cl.push(0)
                    val.push(0)
                }
                for (var i = 0; i < arr.length; i += 1) {
                    if ((arr[i] == "*") || (arr[i] == "/")) {
                        var j = i
                        var kq = init
                        while (j < arr.length) {
                            if (kq == init) {
                                if (arr[j] == "*") kq = arr[j-1] * arr[j+1]
                                else kq = arr[j-1] / arr[j+1]
                            }
                            else {
                                if (arr[j] == "*") kq = kq * arr[j+1]
                                else kq = kq / arr[j+1]
                            }
                            if ((j + 2) >= arr.length) break
                            if ((arr[j+2] != "*") && (arr[j+2] != "/")) break
                            j += 2
                        }
                        cl[i-1] = 1, val[i-1] = kq
                        cl[j+1] = 1, val[j+1] = kq
                        i = j + 1
                    }
                }
                if (cl[0] == 0) current_display = arr[0]
                else current_display = val[0]
                for (var i = 0; i < arr.length; i += 1) {
                    if ((arr[i] == "+") || (arr[i] == "-")) {
                        if (cl[i+1] == 0) {
                            if (arr[i] == "+") current_display += arr[i+1]
                            else current_display -= arr[i+1]
                        }
                        else {
                            if (arr[i] == "+") current_display += val[i+1]
                            else current_display -= val[i+1]
                        }
                    }
                }
            }
            function equal() {
                solve()
                var final_display = current_display
                var result_string = current_display.toString()
                var decimal_index = result_string.indexOf('.')
                if (decimal_index != -1) {
                    var decimal_places = result_string.length - 1 - decimal_index
                    if (decimal_places > 10) {
                        final_display = current_display.toFixed(10)
                    }
                    else {
                        final_display = current_display
                    }
                }
                document.getElementById("screen").innerHTML = final_display
                arr.splice(0, arr.length)
                cl.splice(0, cl.length)
                val.splice(0, val.length)
                current_number = current_display
                ok_add = 0
                ok_sub = 0
                ok_mul = 0
                ok_div = 0
                if (current_display == parseInt(current_display)) oparator = ""
                else operator = "ok_,"
                cnt = 0

            }
            function restart() {
                document.getElementById("screen").innerHTML = "Ready"
                arr.splice(0, arr.length)
                cl.splice(0, cl.length)
                val.splice(0, val.length)
                current_number = 0 
                current_display = init
                ok_add = 0
                ok_sub = 0
                ok_mul = 0
                ok_div = 0
                operator = ""
                cnt = 0
                isInitialState = true
            }
        </script>
    </body>
</html>
